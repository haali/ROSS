<iframe id="streetview-frame" width="100%" height="400px" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>

<script>
let currentLat = 39.6738844;
let currentLng = -75.9476685;

function updateStreetView(lat, lng) {
    currentLat = lat;
    currentLng = lng;
    const iframe = document.getElementById('streetview-frame');
    const streetViewUrl = `https://www.google.com/maps?q=&layer=c&cbll=${lat},${lng}&cbp=11,0,0,0,0&z=17&output=svembed`;
    iframe.src = streetViewUrl;
}

window.addEventListener('message', function(event) {
    console.log('Received message:', event.data); // Debugging line
    if (event.data) {
        let feature = null;
        if (event.data.feature) {
            feature = event.data.feature;
        } else if (event.data.selectedFeature) {
            feature = event.data.selectedFeature;
        } else if (event.data.features && event.data.features.length > 0) {
            feature = event.data.features[0];
        }
        if (feature && feature.attributes) {
            const attrs = feature.attributes;
            // Try multiple possible field names
            let lat = attrs.Y_Mid || attrs.y_mid || attrs.Latitude || attrs.latitude;
            let lng = attrs.X_Mid || attrs.x_mid || attrs.Longitude || attrs.longitude;
            if (lat && lng) {
                updateStreetView(lat, lng);
            }
        }
    }
});

updateStreetView(currentLat, currentLng);
</script>
