<iframe id="streetview-frame" width="100%" height="400px" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>

<script>
// Helper to get URL parameters
function getUrlParam(name) {
    const url = new URL(window.location.href);
    return url.searchParams.get(name);
}

let currentLat = getUrlParam('y') || 39.6738844;
let currentLng = getUrlParam('x') || -75.9476685;

function updateStreetView(lat, lng) {
    currentLat = lat;
    currentLng = lng;
    const iframe = document.getElementById('streetview-frame');
    const streetViewUrl = `https://www.google.com/maps?q=&layer=c&cbll=${lat},${lng}&cbp=11,0,0,0,0&z=17&output=svembed`;
    iframe.src = streetViewUrl;
}

// Listen for Experience Builder feature selection events
window.addEventListener('message', function(event) {
    if (event.data) {
        let feature = null;
        if (event.data.feature) {
            feature = event.data.feature;
        } else if (event.data.selectedFeature) {
            feature = event.data.selectedFeature;
        } else if (event.data.features && event.data.features.length > 0) {
            feature = event.data.features[0];
        }
        if (feature && feature.attributes) {
            const attrs = feature.attributes;
            if (attrs.X_Mid && attrs.Y_Mid) {
                updateStreetView(attrs.Y_Mid, attrs.X_Mid);
            }
        }
    }
});

// Initialize with URL or default coordinates
updateStreetView(currentLat, currentLng);
</script>
